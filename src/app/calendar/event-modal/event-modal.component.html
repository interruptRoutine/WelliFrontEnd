<h2 mat-dialog-title>{{ isNew ? 'Crea Nuovo Evento' : 'Modifica Evento' }}</h2>

<mat-dialog-content>
  <form [formGroup]="eventForm" class="event-form" (keydown.enter)="$event.preventDefault()">

    <mat-form-field appearance="fill">
      <mat-label>Titolo</mat-label>
      <input matInput formControlName="title" required>
      <mat-error *ngIf="eventForm.get('title')?.hasError('required')">
        Il titolo Ã¨ obbligatorio.
      </mat-error>
    </mat-form-field>

    <div class="date-row">
      <mat-form-field appearance="fill" class="date-field">
        <mat-label>Data Inizio</mat-label>
        <input matInput [matDatepicker]="startPicker" formControlName="startDate" required>
        <mat-datepicker-toggle matIconSuffix [for]="startPicker"></mat-datepicker-toggle>
        <mat-datepicker #startPicker></mat-datepicker>
        <mat-error *ngIf="eventForm.get('startDate')?.hasError('required')">
          Data obbligatoria.
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="fill" class="time-field">
        <mat-label>Ora</mat-label>
        <mat-select formControlName="startTime" required>
          <mat-option *ngFor="let time of timeSlots" [value]="time">{{ time }}</mat-option>
        </mat-select>
        <mat-error *ngIf="eventForm.get('startTime')?.hasError('required')">
          Ora obbligatoria.
        </mat-error>
      </mat-form-field>
    </div>

    <div class="date-row">
      <mat-form-field appearance="fill" class="date-field">
        <mat-label>Data Fine</mat-label>
        <input matInput [matDatepicker]="endPicker" formControlName="endDate" required>
        <mat-datepicker-toggle matIconSuffix [for]="endPicker"></mat-datepicker-toggle>
        <mat-datepicker #endPicker></mat-datepicker>
        <mat-error *ngIf="eventForm.get('endDate')?.hasError('required')">
          Data obbligatoria.
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="fill" class="time-field">
        <mat-label>Ora</mat-label>
        <mat-select formControlName="endTime" required>
          <mat-option *ngFor="let time of timeSlots" [value]="time">{{ time }}</mat-option>
        </mat-select>
        <mat-error *ngIf="eventForm.get('endTime')?.hasError('required')">
          Ora obbligatoria.
        </mat-error>
      </mat-form-field>
    </div>

    <div class="row">
      <mat-checkbox formControlName="isAllDay">Tutto il giorno</mat-checkbox>
    </div>

    <mat-form-field appearance="fill">
      <mat-label>Descrizione</mat-label>
      <textarea matInput formControlName="description" rows="3"></textarea>
    </mat-form-field>

    <div class="row">
      <div class="form-field-wrapper">
        <mat-form-field appearance="fill">
          <mat-label>Tipo</mat-label>
          <input matInput formControlName="type" placeholder="Es. Lavoro, Personale...">
        </mat-form-field>
      </div>
      <div class="form-field-wrapper">
        <mat-form-field appearance="fill">
          <mat-label>Promemoria</mat-label>
          <mat-select formControlName="reminderMinutes">
            <mat-option [value]="null">Nessuno</mat-option>
            <mat-option [value]="5">5 minuti prima</mat-option>
            <mat-option [value]="15">15 minuti prima</mat-option>
            <mat-option [value]="30">30 minuti prima</mat-option>
            <mat-option [value]="60">1 ora prima</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>

    <div class="row">
      <div class="form-field-wrapper">
        <mat-form-field appearance="fill">
          <mat-label>Colore</mat-label>
          <input matInput type="color" formControlName="color" class="color-input">
        </mat-form-field>
      </div>
      <div class="form-field-wrapper">
        <mat-form-field appearance="fill">
          <mat-label>Mostra come</mat-label>
          <mat-select formControlName="showAs">
            <mat-option value="BUSY">Occupato</mat-option>
            <mat-option value="FREE">Libero</mat-option>
            <mat-option value="TENTATIVE">Tentativo</mat-option>
            <mat-option value="OUT_OF_OFFICE">Fuori sede</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">

  <button mat-flat-button color="warn"
          *ngIf="!isNew"
          (click)="onDelete()"
          [disabled]="isLoading"
          style="margin-right: auto;">
    Elimina
  </button>

  <button mat-button (click)="onCancel()">Annulla</button>

  <button mat-flat-button color="primary"
          (click)="onSave()"
          [disabled]="eventForm.invalid || isLoading">
    {{ isLoading ? 'Salvataggio...' : 'Salva' }}
  </button>

</mat-dialog-actions>
